<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="OrderInfoMapper">
<select id="orderHistory" parameterType="String" resultType="OrderHistoryDTO">
SELECT
MEMBER_CODE "MEMBER_CODE",
ITEM_NAME "ITEM_NAME",
ITEM.ITEM_IMAGE "ITEM_IMAGE",
ITEM.ITEM_PRICE "ITEM_PRICE",
ORDERITEM.CART_AMOUNT "CART_AMOUNT",
ORDERINFO_ORDERDAY "ORDERINFO_ORDERDAY"
FROM
ORDERITEM ORDERITEM
INNER JOIN ORDERINFO ORDERINFO on ORDERITEM.MEMBER_CODE=ORDERINFO.MEMBER_CODE
INNER JOIN CART CART ON ORDERITEM.MEMBER_CODE=CART.MEMBER_CODE
INNER JOIN ITEM ITEM ON ORDERITEM.ITEM_CODE=ITEM.ITEM_CODE
WHERE MEMBER_CODE=#{MEMBER_CODE}
</select>

<select id="getOredrDay" parameterType="HashMap" resultType="OrderHistoryDTO">
SELECT *
FROM
(SELECT 
ROWNUM "PAGENUM",
ORDERITEM.*
FROM 
(SELECT
ORDERITEM.MEMBER_CODE "MEMBER_CODE",
ORDERITEM.ORDERITEM_CODE "ORDERITEM_CODE",
ITEM_NAME "ITEM_NAME",
ITEM.ITEM_IMAGE "ITEM_IMAGE",
ITEM.ITEM_PRICE "ITEM_PRICE",
ORDERITEM.CART_AMOUNT "CART_AMOUNT",
ORDERINFO_ORDERDAY "ORDERINFO_ORDERDAY",
ORDERINFO_DELIVERY "ORDERINFO_DELIVERY"
FROM
ORDERITEM ORDERITEM
INNER JOIN ITEM ITEM ON ORDERITEM.ITEM_CODE=ITEM.ITEM_CODE
INNER JOIN ORDERINFO ORDERINFO ON ORDERITEM.ORDERINFO_CODE=ORDERINFO.ORDERINFO_CODE
WHERE ORDERITEM.MEMBER_CODE=#{member_code}
AND ORDERINFO_ORDERDAY BETWEEN TO_DATE(#{startDay}, 'YYYYMMDD') AND TO_DATE(#{endDay},'YYYYMMDD')
ORDER BY ORDERINFO_ORDERDAY DESC) "ORDERITEM"
) 
WHERE PAGENUM BETWEEN #{startPage} AND #{endPage}
</select>

<select id="getOredrItem" parameterType="HashMap" resultType="OrderHistoryDTO">

SELECT *
FROM
(SELECT 
ROWNUM "PAGENUM",
ORDERITEM.*
FROM 
(SELECT
ORDERITEM.MEMBER_CODE "MEMBER_CODE",
ORDERITEM.ORDERITEM_CODE "ORDERITEM_CODE",
ITEM_NAME "ITEM_NAME",
ITEM.ITEM_IMAGE "ITEM_IMAGE",
ITEM.ITEM_PRICE "ITEM_PRICE",
ORDERITEM.CART_AMOUNT "CART_AMOUNT",
ORDERINFO_ORDERDAY "ORDERINFO_ORDERDAY",
ORDERINFO_DELIVERY "ORDERINFO_DELIVERY"
FROM
ORDERITEM ORDERITEM
INNER JOIN ITEM ITEM ON ORDERITEM.ITEM_CODE=ITEM.ITEM_CODE
INNER JOIN ORDERINFO ORDERINFO ON ORDERITEM.ORDERINFO_CODE=ORDERINFO.ORDERINFO_CODE
WHERE ORDERITEM.MEMBER_CODE=#{member_code}
AND ORDERINFO_ORDERDAY BETWEEN TO_DATE(#{startDay}, 'YYYYMMDD') AND TO_DATE(#{endDay},'YYYYMMDD')
ORDER BY ORDERINFO_ORDERDAY DESC) "ORDERITEM"
) 
WHERE PAGENUM BETWEEN #{startPage} AND #{endPage}
AND ITEM_NAME=#{item_name}

</select>

<select id="totalCount" parameterType="String" resultType="int">
SELECT
COUNT(*)
FROM
ORDERITEM ORDERITEM
INNER JOIN ITEM ITEM ON ORDERITEM.ITEM_CODE=ITEM.ITEM_CODE
INNER JOIN ORDERINFO ORDERINFO ON ORDERITEM.ORDERINFO_CODE=ORDERINFO.ORDERINFO_CODE
WHERE ORDERITEM.MEMBER_CODE=#{member_code}
ORDER BY ORDERINFO_ORDERDAY DESC
</select>
</mapper>